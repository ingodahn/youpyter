var data={breakpoints:{},segments:[],nbCells:[],endTime:1e6,kernel:"sage",system:ytactivatorPath,video:null};function readURL(e){if(e.files&&e.files[0]){var t=new FileReader;t.onload=function(e){$(".file-upload").hide(),activate(e.target.result)},t.readAsDataURL(e.files[0])}else alert("Could not upload file")}function activate(e){try{$(".file-upload").remove();var t=JSON.parse(atob(e.split(",")[1]));kernel=t.metadata.kernelspec.name,kernel.includes("sage")&&(kernel="sage");for(var l=0;l<t.cells.length;l++){var a=t.cells[l];if("code"==a.cell_type)$("#notebook-wrapper").append(makeCodeCell(a,l));else{let e=makeMarkdownCell(a,l);e&&$("#notebook-wrapper").append(e)}}renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0,strict:!1},{left:"$",right:"$",display:!1}]})}catch(e){$("#main").append("<p>Error: "+e+"</p>")}}function makeCodeCell(e,t){var l=e.source?e.source.join(""):"",a=$('<div class="cell code-cell" id="cell'+t+'"></div>');return a.append('<div class="cell-input">'+sageCell(l)+"</div>"),addCell(e,t),$("#calcNext").css("visibility","visible"),a}function makeMarkdownCell(e,t){var l=e.source.join("");let a=hasVideo(l);if(a)return(i=$('<div class="cell" id="cell'+t+'"></div>')).append(buttonRow),data.video={videoId:a.id,width:a.width,height:a.height},i.append(makeYtPlayer()),getSections(l),makeYtPlayer(),null;var i,n=new Remarkable({html:!0,breaks:!0,linkify:!0}).render(l);return(i=$('<div class="cell markdown-cell row" id="cell'+t+'"></div>')).append("<div>"+n+"</div>"),addCell(e,t),i}function hasVideo(e){let t=/\"https:\/\/www.youtube.com\/embed\/([^\"]*)\"/gm.exec(e);if(t){let l=t[1],a=/width=\"([^\"]*)\"/gm.exec(e),i=640;a&&(i=a[1]);let n=/height=\"([^\"]*)\"/gm.exec(e),d=480;return n&&(d=n[1]),{id:l,width:i,height:d}}return null}function getSections(e){let t=e.split("\n");for(let e=0;e<t.length;e++){let l=t[e],a=/\|\s*([^\|]*)\s*\|\s*([^\|]*)\s*\|\s*([^\|]*)\s*\|\s*([^\|]*)\s*\|/gm.exec(l);if(a&&a[0].indexOf(":")>=0){let e={title:a[3].trim(),start:time2sec(a[1].trim()),end:time2sec(a[2].trim()),id:a[4].trim()};data.segments.push(e),data.breakpoints[e.start]=!0,data.breakpoints[e.end]=!0}}makeToc()}function time2sec(e){let t=e.split(":");return 60*+t[0]+ +t[1]}function addCell(e,t){if(e.metadata&&e.metadata.in){let l=e.metadata.in,a=data.segments.find((e=>e.id==l));data.nbCells.push({content:"cell"+t,start:a.start,end:a.end,cellType:e.cell_type,cellEvaluated:!1})}}