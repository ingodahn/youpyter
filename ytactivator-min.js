var data={breakpoints:{},segments:[],nbCells:[],endTime:1e6,kernel:"sage",system:ytactivatorPath,video:null,name:"ytActivator"};function readURL(e){if(e.files&&e.files[0]){data.name=e.files[0].name.substring(0,e.files[0].name.lastIndexOf("."));var t=new FileReader;t.onload=function(e){$(".file-upload").hide(),activate(e.target.result)},t.readAsDataURL(e.files[0])}else alert("Could not upload file")}function activate(e){try{$(".file-upload").remove();var t=JSON.parse(atob(e.split(",")[1]));kernel=t.metadata.kernelspec.name,kernel.includes("sage")&&(kernel="sage"),getAllSections(t.cells);for(var l=0;l<t.cells.length;l++){var a=t.cells[l];if("code"==a.cell_type)$("#notebook-wrapper").append(makeCodeCell(a,l));else{let e=makeMarkdownCell(a,l);e&&$("#notebook-wrapper").append(e)}}renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0,strict:!1},{left:"$",right:"$",display:!1}]})}catch(e){$("#main").append("<p>Error: "+e+"</p>")}}function makeCodeCell(e,t){var l=e.source?e.source.join(""):"",a=$('<div class="cell code-cell" id="cell'+t+'"></div>');return a.append('<div class="cell-input">'+sageCell(l)+"</div>"),addOneCell(e,t),$("#calcNext").css("visibility","visible"),a}function makeMarkdownCell(e,t){var l=e.source.join("");let a=hasVideo(l);if(a)return(n=$('<div class="cell" id="cell'+t+'"></div>')).append(buttonRow),data.video={videoId:a.id,width:a.width,height:a.height},n.append(makeYtPlayer()),makeYtPlayer(),null;var n,i=new Remarkable({html:!0,breaks:!1,linkify:!0}),d=l.replace(/\\\\/g,"\\\\\\\\"),s=i.render(d);return(n=$('<div class="cell markdown-cell row" id="cell'+t+'"></div>')).append("<div>"+s+"</div>"),addOneCell(e,t),n}function hasVideo(e){let t=/\"https:\/\/www.youtube.com\/embed\/([^\"]*)\"/gm.exec(e);if(t){let l=t[1],a=/width=\"([^\"]*)\"/gm.exec(e),n=640;a&&(n=a[1]);let i=/height=\"([^\"]*)\"/gm.exec(e),d=480;return i&&(d=i[1]),{id:l,width:n,height:d}}return null}function getAllSections(e){for(var t=0;t<e.length;t++){var l=e[t];if("markdown"==l.cell_type){let e=/<!--[\s]*Section:(.*)Time/,a=l.source[0],n=e.exec(a);if(n){let e=n[1].trim(),l=/Time:(.*)-->/;if(!l.exec(a))throw"Section "+e+" has no time";{let n={title:e,start:time2sec(l.exec(a)[1].trim()),end:999,cellNr:t,id:"section"+t};data.segments.push(n),data.segments.length>1&&(data.segments[data.segments.length-2].end=n.start),data.breakpoints[n.start]=!0,data.breakpoints[n.end]=!0}}}}makeToc()}function time2sec(e){let t=e.split(":");return 60*+t[0]+ +t[1]}function addOneCell(e,t){let l=0;for(j=0;j<data.segments.length&&data.segments[j].cellNr<=t;j++)l=j;let a=data.segments[l];data.nbCells.push({content:"cell"+t,start:a.start,end:a.end,cellType:e.cell_type,cellEvaluated:!1})}