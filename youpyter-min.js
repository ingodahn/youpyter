var data={breakpoints:{},segments:[],nbCells:[],endTime:1e6,kernel:"sage",system:youpyterPath,video:null,name:"youpyter"};function readURL(e){if(e.files&&e.files[0]){data.name=e.files[0].name.substring(0,e.files[0].name.lastIndexOf("."));var t=new FileReader;t.onload=function(e){$(".file-upload").hide(),activate(e.target.result)},t.readAsDataURL(e.files[0])}else alert("Could not upload file")}function activate(e){try{$(".file-upload").remove();var t=JSON.parse(atob(e.split(",")[1]));kernel=t.metadata.kernelspec.name,kernel.includes("sage")&&(kernel="sage"),getAllSections(t.cells),getVideo(t.cells[0]);for(var l=1;l<t.cells.length;l++){let e="row"+l;$("#notebook-wrapper").append('<div class="row" id="'+e+'"><div class="side col-1" id="side'+l+'"></div></div>');var a=t.cells[l];if("code"==a.cell_type)$("#"+e).append(makeCodeCell(a,l));else{let t=makeMarkdownCell(a,l);t&&$("#"+e).append(t)}}addPlayButtons(),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0,strict:!1},{left:"$",right:"$",display:!1}]})}catch(e){$("#main").append("<p>Error: "+e+"</p>")}}function makeCodeCell(e,t){var l=e.source?e.source.join(""):"",a=$('<div class="cell code-cell col" id="cell'+t+'"></div>');return a.append('<div class="cell-input">'+sageCell(l)+"</div>"),addOneCell(e,t),$("#calcNext").css("visibility","visible"),a}function getVideo(e){let t=hasVideo(e.source.join(""));if(t){var l=$('<div class="cell" id="cell0"></div>');l.append(buttonRow),data.video={videoId:t.id,width:t.width,height:t.height},l.append(makeYtPlayer()),makeYtPlayer()}else alert("First cell must be a video")}function makeMarkdownCell(e,t){var l=e.source.join(""),a=new Remarkable({html:!0,breaks:!1,linkify:!0}),i=l.replace(/\\\\/g,"\\\\\\\\"),n=a.render(i),d=$('<div class="cell markdown-cell col" id="cell'+t+'"></div>');return d.append("<div>"+n+"</div>"),addOneCell(e,t),d}function hasVideo(e){let t=/\"https:\/\/www.youtube.*\.com\/embed\/([^\"]*)\"/gm.exec(e);if(t){let l=t[1],a=/width=\"([^\"]*)\"/gm.exec(e),i=640;a&&(i=a[1]);let n=/height=\"([^\"]*)\"/gm.exec(e),d=480;return n&&(d=n[1]),{id:l,width:i,height:d}}return null}function getAllSections(e){for(var t=0;t<e.length;t++){var l=e[t];if("markdown"==l.cell_type){let e=/<!--[\s]*Section:(.*)Time/,a=l.source[0],i=e.exec(a);if(i){let e=i[1].trim(),l=/Time:(.*)-->/;if(!l.exec(a))throw"Section "+e+" has no time";{let i={title:e,start:time2sec(l.exec(a)[1].trim()),end:999,cellNr:t,id:"section"+t};data.segments.push(i),data.segments.length>1&&(data.segments[data.segments.length-2].end=i.start),data.breakpoints[i.start]=!0,data.breakpoints[i.end]=!0}}}}makeToc()}function time2sec(e){let t=e.split(":");return 60*+t[0]+ +t[1]}function addOneCell(e,t){let l=0;for(j=0;j<data.segments.length&&data.segments[j].cellNr<=t;j++)l=j;let a=data.segments[l];data.nbCells.push({content:"cell"+t,start:a.start,end:a.end,cellType:e.cell_type,cellEvaluated:!1})}function addPlayButtons(){for(var e=0;e<data.segments.length;e++)$("#side"+data.segments[e].cellNr).append(playButton(e))}imgPath="./images/";