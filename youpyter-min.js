var data={breakpoints:{},segments:[],nbCells:[],endTime:1e6,kernel:"sage",system:youpyterPath,video:null,name:"youpyter"};function readURL(e){if(e.files&&e.files[0]){data.name=e.files[0].name.substring(0,e.files[0].name.lastIndexOf("."));var t=new FileReader;t.onload=function(e){$(".file-upload").hide(),activate(e.target.result)},t.readAsDataURL(e.files[0])}else alert("Could not upload file")}function activate(e){try{$(".file-upload").remove();var t=JSON.parse(atob(e.split(",")[1]));let n=t.metadata.kernelspec.language,d=n.toLowerCase();d.includes("sage")?data.kernel="sage":d.includes("python")?data.kernel="python":d.includes("singular")?data.kernel="singular":d.includes("octave")?data.kernel="octave":d.includes("maxima")?data.kernel="maxima":d.includes("html")?data.kernel="html":d.includes("gp")?data.kernel="gp":d.includes("r")?data.kernel="r":d.includes("gap")?data.kernel="gap":d.includes("macauley2")?data.kernel="macauley2":(alert("Kernel "+n+" not supported, using Sage (default)"),data.kernel="sage"),getAllSections(t.cells),getVideo(t.cells[0]);for(var a=1;a<t.cells.length;a++){let e="row"+a;$("#notebook-wrapper").append('<div class="row" id="'+e+'"><div class="side col-1" id="side'+a+'"></div></div>');var l=t.cells[a];if("code"==l.cell_type)$("#"+e).append(makeCodeCell(l,a));else{let t=makeMarkdownCell(l,a);t&&$("#"+e).append(t)}}addPlayButtons(),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0,strict:!1},{left:"$",right:"$",display:!1}]})}catch(e){$("#main").append("<p>Error: "+e+"</p>")}}function makeCodeCell(e,t){var a=e.source?e.source.join(""):"",l=$('<div class="cell code-cell col" id="cell'+t+'"></div>');return l.append('<div class="cell-input">'+sageCell(a)+"</div>"),addOneCell(e,t),$("#calcNext").css("visibility","visible"),l}function getVideo(e){let t=hasVideo(e.source.join(""));if(t){var a=$('<div class="cell" id="cell0"></div>');a.append(buttonRow),data.video={videoId:t.id,width:t.width,height:t.height},a.append(makeYtPlayer()),makeYtPlayer()}else alert("First cell must be a video")}function makeMarkdownCell(e,t){var a=e.source.join(""),l=new Remarkable({html:!0,breaks:!1,linkify:!0}),n=a.replace(/\\\\/g,"\\\\\\\\"),d=l.render(n),i=$('<div class="cell markdown-cell col" id="cell'+t+'"></div>');return i.append("<div>"+d+"</div>"),addOneCell(e,t),i}function hasVideo(e){let t=/\"https:\/\/www.youtube.*\.com\/embed\/([^\"]*)\"/gm.exec(e);if(t){let a=t[1],l=/width=\"([^\"]*)\"/gm.exec(e),n=640;l&&(n=l[1]);let d=/height=\"([^\"]*)\"/gm.exec(e),i=480;return d&&(i=d[1]),{id:a,width:n,height:i}}return null}function getAllSections(e){for(var t=0;t<e.length;t++){var a=e[t];if("markdown"==a.cell_type){let e=/<!--[\s]*Section:(.*)Time/,l=a.source[0],n=e.exec(l);if(n){let e=n[1].trim(),a=/Time:(.*)-->/;if(!a.exec(l))throw"Section "+e+" has no time";{let n={title:e,start:time2sec(a.exec(l)[1].trim()),end:999,cellNr:t,id:"section"+t};data.segments.push(n),data.segments.length>1&&(data.segments[data.segments.length-2].end=n.start),data.breakpoints[n.start]=!0,data.breakpoints[n.end]=!0}}}}makeToc()}function time2sec(e){let t=e.split(":");return 60*+t[0]+ +t[1]}function addOneCell(e,t){let a=0;for(j=0;j<data.segments.length&&data.segments[j].cellNr<=t;j++)a=j;let l=data.segments[a];data.nbCells.push({content:"cell"+t,start:l.start,end:l.end,cellType:e.cell_type,cellEvaluated:!1})}function addPlayButtons(){for(var e=0;e<data.segments.length;e++)$("#side"+data.segments[e].cellNr).append(playButton(e))}imgPath="./images/";