var data={breakpoints:{},segments:[],nbCells:[],endTime:1e6,kernel:"sage",system:youpyterPath,video:null,name:"youpyter"};function readURL(e){if(e.files&&e.files[0]){data.name=e.files[0].name.substring(0,e.files[0].name.lastIndexOf("."));var t=new FileReader;t.onload=function(e){$(".file-upload").hide(),activate(e.target.result)},t.readAsDataURL(e.files[0])}else alert("Could not upload file")}function activate(e){try{$(".file-upload").remove();var t=JSON.parse(atob(e.split(",")[1]));let n=t.metadata.kernelspec.language,i=n.toLowerCase();i.includes("sage")?data.kernel="sage":i.includes("python")?data.kernel="python":i.includes("singular")?data.kernel="singular":i.includes("octave")?data.kernel="octave":i.includes("maxima")?data.kernel="maxima":i.includes("html")?data.kernel="html":i.includes("gp")?data.kernel="gp":i.includes("r")?data.kernel="r":i.includes("gap")?data.kernel="gap":i.includes("macauley2")?data.kernel="macauley2":(alert("Kernel "+n+" not supported, using Sage (default)"),data.kernel="sage"),getAllSections(t.cells),getVideo(t.cells[0]);for(var l=1;l<t.cells.length;l++){let e="row"+l;$("#notebook-wrapper").append('<div class="row" id="'+e+'"><div class="side col-1" id="side'+l+'"></div></div>');var a=t.cells[l];if("code"==a.cell_type)$("#"+e).append(makeCodeCell(a,l));else{let t=makeMarkdownCell(a,l);t&&$("#"+e).append(t)}}addPlayButtons(),renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0,strict:!1},{left:"$",right:"$",display:!1}]})}catch(e){$("#main").append("<p>Error: "+e+"</p>")}}function makeCodeCell(e,t){var l=e.source?e.source.join(""):"",a=$('<div class="cell code-cell col" id="cell'+t+'"></div>');return a.append('<div class="cell-input">'+sageCell(l)+"</div>"),addOneCell(e,t),$("#calcNext").css("visibility","visible"),a}function getVideo(e){let t=hasVideo(e.source.join(""));if(t){var l=$('<div class="cell" id="cell0"></div>');l.append(buttonRow),data.video={videoId:t.id,width:t.width,height:t.height},l.append(makeYtPlayer()),makeYtPlayer()}else alert("First cell must be a video")}function makeMarkdownCell(e,t){var l=e.source.join(""),a=new Remarkable({html:!0,breaks:!1,linkify:!0}),n=l.replace(/\\\\/g,"\\\\\\\\"),i=a.render(n),d=$('<div class="cell markdown-cell col" id="cell'+t+'"></div>');return d.append("<div>"+i+"</div>"),addOneCell(e,t),d}function hasVideo(e){let t=/\"https:\/\/www.youtube.*\.com\/embed\/([^\"?]*)[\"?]/gm.exec(e);if(t){let l=t[1],a=/width=\"([^\"]*)\"/gm.exec(e),n=640;a&&(n=a[1]);let i=/height=\"([^\"]*)\"/gm.exec(e),d=480;i&&(d=i[1]);let s={id:l,width:n,height:d};s.id,s.width,s.height;return s}return null}function getAllSections(e){for(var t=0;t<e.length;t++){var l=e[t];if("markdown"==l.cell_type){let e=/<!--[\s]*Section:(.*)Time/,a=l.source[0],n=e.exec(a);if(n){let e=n[1].trim(),l=/Time:(.*)-->/;if(!l.exec(a))throw"Section "+e+" has no time";{let n={title:e,start:time2sec(l.exec(a)[1].trim()),end:999,cellNr:t,id:"section"+t};data.segments.push(n),data.segments.length>1&&(data.segments[data.segments.length-2].end=n.start),data.breakpoints[n.start]=!0,data.breakpoints[n.end]=!0}}}}makeToc()}function time2sec(e){let t=e.split(":");return 60*+t[0]+ +t[1]}function addOneCell(e,t){let l=0;for(j=0;j<data.segments.length&&data.segments[j].cellNr<=t;j++)l=j;let a=data.segments[l];data.nbCells.push({content:"cell"+t,start:a.start,end:a.end,cellType:e.cell_type,cellEvaluated:!1})}function addPlayButtons(){for(var e=0;e<data.segments.length;e++)$("#side"+data.segments[e].cellNr).append(playButton(e))}imgPath="./images/";