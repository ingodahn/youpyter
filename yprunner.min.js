function getBrowserLanguage(){return(navigator.language||navigator.userLanguage).substring(0,2)}const getScrollParent=e=>null===e?null:e.scrollHeight>e.clientHeight?e:getScrollParent(e.parentNode);function syncTo(e){$(".cell").removeClass("current-cell");let t=null;for(var n=0;n<data.nbCells.length;n++)if(e>=data.nbCells[n].start&&e<data.nbCells[n].end){let e=data.nbCells[n].content;t||(t=e),$(e).addClass("current-cell")}checkEvaluated(),t||(t=data.nbCells[data.nbCells.length-1].content);let a=document.getElementById(t),l=document.getElementById("player-nav").getClientRects()[0],s=a.getClientRects()[0];window.scrollBy({left:0,top:s.y-l.height,behavior:"smooth"})}function checkEvaluated(){let e=null;$(".cell").removeClass(["evaluated","evaluable","notEvaluated"]);for(let t=0;t<data.nbCells.length;t++)"code"==data.nbCells[t].cellType&&(data.nbCells[t].cellEvaluated?$("#"+data.nbCells[t].content).addClass("evaluated"):null==e?(e=data.nbCells[t].content,$("#"+e).addClass("evaluable")):$("#"+data.nbCells[t].content).addClass("notEvaluated"));return e?$("#calcNext").prop("disabled",!1):$("#calcNext").prop("disabled",!0),e}function sageCell(e){return'<div class="compute"><script type="text/x-sage">'+e+"<\/script></div>"}function makeSageCells(){sagecell.makeSagecell({inputLocation:".compute",linked:!0,languages:[data.kernel],callback:()=>{$(".sagecell_evalButton").click((function(){let e=this.parentNode.parentNode.parentNode.parentNode.id,t=data.nbCells.findIndex((t=>t.content==e));data.nbCells[t].cellEvaluated=!0,checkEvaluated()}))}})}function calcNext(){let e=null;for(let t=0;t<data.nbCells.length;t++)if("code"==data.nbCells[t].cellType&&!data.nbCells[t].cellEvaluated){e=data.nbCells[t].start;break}player.seekTo(e),syncTo(e)}function saveHtml(){$(".playButton img").attr("src",data.system+"/images/play.png"),saveAddSageCells(".code-cell",".sagecell_input,.sagecell_output"),saveInitEvaluated();let e=document.getElementsByClassName("code-cell");for(let t=0;t<e.length;t++)e[t].innerHTML=e[t].innerHTML.replace(/\u200B/g,"");let t=document.getElementsByClassName("markdown-cell");for(let e=0;e<t.length;e++)t[e].innerHTML=t[e].innerHTML.replace(/\u2212+/g,"-"),t[e].innerHTML=t[e].innerHTML.replace(/\u2032+/g,"'");var n=new Blob(['<!DOCTYPE html>\n<html>\n<head><head>\n <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"><\/script>\n <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">\n  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"><\/script>\n <script src="'+data.system+'/vendor/js/FileSaver.min.js"><\/script>\n <script src="https://cdn.jsdelivr.net/remarkable/1.7.1/remarkable.min.js"><\/script>\n <meta charset="utf-8">\n <title>'+data.name+'</title>\n <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.css" integrity="sha384-vKruj+a13U8yHIkAyGgK1J3ArTLzrFGBbBc0tDp4ad/EyewESeXE/Iv67Aj8gKZ0" crossorigin="anonymous">\n  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/katex.min.js" integrity="sha384-PwRUT/YqbnEjkZO0zZxNqcxACrXe+j766U2amXcgMg5457rve2Y7I6ZJSm2A0mS4" crossorigin="anonymous"><\/script>\n  \x3c!-- To automatically render math in text elements, include the auto-render extension: --\x3e\n  <script src="https://cdn.jsdelivr.net/npm/katex@0.16.4/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"\n        onload="renderMathInElement(document.body);"><\/script>\n <script src="https://sagecell.sagemath.org/embedded_sagecell.js"><\/script>\n <link rel="stylesheet" href="'+data.system+'/youpyter.min.css">\n <link rel="stylesheet" href="./custom.css">\n</head>\n<body>\n<div id="main">\n<row>\n      <div id="player-nav">\n        <div id="player-wrapper"></div>\n        <button type="button" class="btn btn-primary playButton" onclick="playToggle()"><img src="'+data.system+'/images/play.png"\n          width="20px"></img></button>\n        <select id="toc" onchange="ytSeekTo(this.selectedIndex)"></select>\n        <button id="calcNext" type="button" class="btn btn-primary" onclick="calcNext()">Next Calculation</button>\n        <button id="save" type="button" class="btn btn-primary" onclick="saveHtml()">Save</button>\n      </div>\n    </row>\n    <div id=\'notebook-wrapper\'>'+$("#notebook-wrapper").html()+"</div>\n  </div>\n  <script>\n    var data ="+JSON.stringify(data)+';\n    const youpyterPath = "'+data.system+'";\n  <\/script>\n  <script src="'+data.system+'/ytcontrol.min.js"><\/script>\n <script src="'+data.system+'/yprunner.min.js"><\/script>\n  <script>\n    makeYtPlayer();\n    makeToc();\n    setCalcSave();\n    makeSageCells();\n    syncTo(0);\n    renderMathInElement(document.body, { delimiters: [{ left: "$$", right: "$$", display: true, strict: false }, { left: "$", right: "$", display: false }] });\n  <\/script>\n  <script src="./custom.js"><\/script>\n  </body></html>'],{type:"text/plain;charset=utf-8"});saveAs(n,data.name+".html");let a="Do NOT use this page anymore - open your saved copy or reload this page.";"de"==getBrowserLanguage()&&(a="Bitte die Seite nach dem Speichern neu laden oder die gespeicherte Kopie Ã¶ffnen."),alert(a)}function saveAddSageCells(e,t){$(e).each((function(){let e=getSageInput($(this));e=e.replace(/\u200B/g,"");let t="\n    <div class='cell-input'>\n      <div class='compute'>\n        <script type='text/x-sage'>"+e+"<\/script>\n      </div>\n    </div>";$(this).html(t)}))}function getSageInput(e){let t="";return e.find(".CodeMirror-line").each((function(){t+=$(this).text()+"\n"})),t}function saveInitEvaluated(){for(let e=0;e<data.nbCells.length;e++)"code"==data.nbCells[e].cellType&&(data.nbCells[e].cellEvaluated=!1)}function makeToc(){for(let e=0;e<data.segments.length;e++)$("#toc").append('<option value="'+data.segments[e].start+'">'+data.segments[e].title+"</option>")}function setCalcSave(){let e=document.getElementsByClassName("code-cell").length;e<2&&$("#calcNext").hide(),e<1&&$("#save").hide()}